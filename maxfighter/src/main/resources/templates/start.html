<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MaxFighter - SeleÃ§Ã£o de Personagem</title>

    <style>
        :root {
            --color-background: #C4A484;
            --color-inner-bg: #EED7B8;
            --color-border-dark: #4D281F;
            --color-text-dark: #333333;
            --color-title-light: #FFEB3B;
            --color-selection-border: #FF7043;
            --color-player1: #C43030;
            --color-player2: #306DC4;
            --color-locked: #8D8D8D;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            background-color: var(--color-background);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            background-image: url('select.jpeg');
            background-size: cover;
            background-position: center;
            image-rendering: pixelated;
        }
        .select-container {
            width: 90%;
            max-width: 1000px;
            padding: 30px;
            box-sizing: border-box;
            background-color: rgba(238,215,184,0.95);
            border: 10px solid var(--color-border-dark);
            box-shadow: 0 0 0 15px var(--color-background);
            border-radius: 5px;
            text-align: center;
            position: relative;
        }
        .title-select {
            font-size: 3rem; color: var(--color-text-dark);
            margin-bottom: 20px; text-transform: uppercase;
            text-shadow: 4px 4px 0px var(--color-border-dark);
            line-height:1.2;
        }
        .title-select span {
            color: var(--color-selection-border);
            text-shadow: 4px 4px 0 var(--color-border-dark);
            display:block; font-size:4rem;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 20px;
            margin-bottom: 30px;
            background-color: var(--color-background);
            border: 5px solid var(--color-border-dark);
            image-rendering: pixelated;
        }

        .char-slot {
            background-color: var(--color-inner-bg);
            border: 4px solid var(--color-border-dark);
            padding: 10px;
            cursor: pointer;
            transition: transform 0.12s, box-shadow 0.12s;
            position: relative;
            min-height: 150px;
            display:flex;
            flex-direction:column;
            justify-content:flex-end;
            align-items:center;
        }
        .char-slot:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 0 0 var(--color-border-dark);
        }
        .char-image-placeholder { width:100px; height:100px; border:2px dashed var(--color-border-dark); background:white; }
        .char-slot img { width:100%; height:100%; object-fit:cover; }

        .char-name { font-size:0.9rem; font-weight:bold; color:var(--color-text-dark); }

        .char-slot.ia-cursor {
            border:4px solid var(--color-title-light) !important;
            box-shadow:0 0 10px var(--color-title-light);
            transform:scale(1.05);
        }
        .p1-selected { box-shadow:0 0 15px var(--color-player1); pointer-events:none; }
        .p2-selected { box-shadow:0 0 15px var(--color-player2); pointer-events:none; }
    </style>
</head>
<body>

    <!-- ÃUDIO -->
    <audio id="select-audio" src="/audio/selecao.mp3" preload="auto"></audio>

    <!-- FORM -->
    <form id="start-form" action="/battle/select" method="POST" style="display:none;">
        <input type="hidden" name="playerName" id="form-playerName">
        <input type="hidden" name="aiName" id="form-aiName">
    </form>

    <div class="select-container">
        <h1 class="title-select">Select Your <span>Paint-Emon!</span></h1>

        <div class="character-grid">

            <!-- SNORMAX -->
            <div class="char-slot" data-char-id="snormax" data-name="Snormax">
                <div class="char-image-placeholder"><img src="/img/snormax.png"></div>
                <span class="char-name">Snormax</span>
            </div>

            <!-- TINTACRUEL -->
            <div class="char-slot" data-char-id="tintacruel" data-name="TintaCruel">
                <div class="char-image-placeholder"><img src="/img/tintacruel.png"></div>
                <span class="char-name">TintaCruel</span>
            </div>

            <!-- BALDESTOISE -->
            <div class="char-slot" data-char-id="baldestoise" data-name="Baldestoise">
                <div class="char-image-placeholder"><img src="/img/baldestoise.png"></div>
                <span class="char-name">Baldestoise</span>
            </div>

            <!-- WEEPINCEL -->
            <div class="char-slot" data-char-id="weepincel" data-name="Weepincel">
                <div class="char-image-placeholder"><img src="/img/weepincel.png"></div>
                <span class="char-name">Weepincel</span>
            </div>

            <!-- COLORFABLE -->
            <div class="char-slot" data-char-id="colorfable" data-name="ColorFable">
                <div class="char-image-placeholder"><img src="/img/colorfable.png"></div>
                <span class="char-name">ColorFable</span>
            </div>

            <!-- BORRACHAURO -->
            <div class="char-slot" data-char-id="borrachauro" data-name="Borrachauro">
                <div class="char-image-placeholder"><img src="/img/borrachauro.png"></div>
                <span class="char-name">Borrachauro</span>
            </div>

            <!-- CATERPRIMER -->
            <div class="char-slot" data-char-id="caterprimer" data-name="CaterPrimer">
                <div class="char-image-placeholder"><img src="/img/caterprimer.png"></div>
                <span class="char-name">CaterPrimer</span>
            </div>

            <!-- HITMONLIXA -->
            <div class="char-slot" data-char-id="hitmonlixa" data-name="HitmonLixa">
                <div class="char-image-placeholder"><img src="/img/hitmonlixa.png"></div>
                <span class="char-name">HitmonLixa</span>
            </div>

        </div>
    </div>

<script>
    const music = new Audio("/audio/selecao.mp3");
    music.volume = 0.7;
    music.loop = true;

    let player1Selection = null;
    let player2Selection = null;
    let isSelecting = false;

    const charSlots = document.querySelectorAll('.char-slot');
    const startForm = document.getElementById('start-form');
    const formPlayerInput = document.getElementById('form-playerName');
    const formAiInput = document.getElementById('form-aiName');

    let audioAuthorized = false;

    // Autoriza mÃºsica pelo clique
    function authorizeAudio() {
        if (audioAuthorized) return;

        music.play().then(() => {
            music.pause();
            music.currentTime = 0;
            audioAuthorized = true;
        }).catch(() => {
            document.body.addEventListener("click", authorizeAudio, { once:true });
        });
    }

    function startMusicIA() {
        if (audioAuthorized) {
            music.currentTime = 0;
            music.play();
        }
    }

    function stopMusicIA() {
        music.pause();
        music.currentTime = 0;
    }

    // AnimaÃ§Ã£o IA
    function animateSelection(selectingPlayerId, callback) {
        isSelecting = true;

        // ðŸ”¥ ComeÃ§a a mÃºsica no inÃ­cio da animaÃ§Ã£o da IA
        startMusicIA();

        const available = Array.from(charSlots).filter(s => {
            if (selectingPlayerId === "p2" && s.dataset.charId === "random") return false;
            if (player1Selection && s.dataset.charId === player1Selection) return false;
            return true;
        });

        let index = 0;
        const total = 15;

        const interval = setInterval(() => {
            available.forEach(s => s.classList.remove("ia-cursor"));
            available[index % available.length].classList.add("ia-cursor");

            index++;
            if (index > total) {
                clearInterval(interval);

                available.forEach(s => s.classList.remove("ia-cursor"));

                // ðŸ”¥ Para mÃºsica no final da seleÃ§Ã£o da IA
                stopMusicIA();

                callback(available[Math.floor(Math.random()*available.length)], selectingPlayerId);
                isSelecting = false;
            }
        }, 180);
    }

    function finalizeSelection(slot, playerId) {
        if (!slot) return;

        if (playerId === "p1") player1Selection = slot.dataset.charId;
        else player2Selection = slot.dataset.charId;

        slot.classList.add(playerId === "p1" ? "p1-selected" : "p2-selected");

        if (playerId === "p1") {
            setTimeout(() => animateSelection("p2", finalizeSelection), 600);
            return;
        }

        if (player1Selection && player2Selection) {
            const p1 = document.querySelector(`[data-char-id="${player1Selection}"]`);
            const p2 = document.querySelector(`[data-char-id="${player2Selection}"]`);

            formPlayerInput.value = p1.dataset.name;
            formAiInput.value = p2.dataset.name;

            startForm.submit();
        }
    }

    charSlots.forEach(slot => {
        slot.addEventListener("click", () => {
            if (isSelecting || player1Selection) return;

            // ðŸ”¥ autoriza Ã¡udio no clique
            authorizeAudio();

            if (slot.dataset.charId === "random") {
                animateSelection("p1", finalizeSelection);
            } else {
                finalizeSelection(slot, "p1");
            }
        });
    });
</script>

</body>
</html>
